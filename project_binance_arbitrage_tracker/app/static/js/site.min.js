function urlB64ToUint8Array(n){const r="=".repeat((4-n.length%4)%4),u=(n+r).replace(/\-/g,"+").replace(/_/g,"/"),t=window.atob(u),i=new Uint8Array(t.length);for(let n=0;n<t.length;++n)i[n]=t.charCodeAt(n);return i}const applicationServerPublicKey="BPYLUodfzeCVpUO3VjbnAof7dw0BXthLVm7Q1lkYpulqUytidKwqer2NaGNvxOl43JDLr7lD3lvMxx6i8N2PJlM";let swRegistration=null;$(document).ready(function(){function n(n,t,i){var r,u;t&&(r=t.getKey?t.getKey("p256dh"):"",p256dh=r?btoa(String.fromCharCode.apply(null,new Uint8Array(r))):"",u=t.getKey?t.getKey("auth"):"",authSecret=u?btoa(String.fromCharCode.apply(null,new Uint8Array(u))):"",$.ajax({url:"/api/"+n,type:"POST",data:{Endpoint:t.endpoint,P256dh:p256dh,Auth:authSecret,CurrencyName:i}}))}SocialShareKit.init();$("input[name='skin']").on("change",function(){gtag("event","toggle",{event_category:"Theme",transport_type:"beacon",event_label:$(this).val()});$.ajax({url:"/api/settheme",type:"POST",data:{theme:$(this).val()},success:function(){window.location.href=window.location.href.replace(/#.*$/,"")}})});$("#modal_subscribe").on("show.bs.modal",function(n){var t=$(n.relatedTarget),i=t.data("currency");"serviceWorker"in navigator&&"PushManager"in window?navigator.serviceWorker.register("/js/sw.js").then(function(n){swRegistration=n}).catch(function(n){console.error("Service Worker Error",n)}):$("#webpushnotification")&&$("#webpushnotification").addClass("d-none");$.ajax({url:"/api/getsymbol",type:"GET",data:{name:i},success:function(n){n&&($("#currencySpan").text(n.name+" ("+n.symbol+")"),$("#checkcurrency").val(n.cleanName),$("#checkcurrencyall").prop("checked",!0),$("#btnsubscribe").removeClass("d-none"),$("#btnunsubscribe").addClass("d-none"),$("input:radio").attr("disabled",!1),swRegistration.pushManager.getSubscription().then(function(t){if(t){var i=t.getKey?t.getKey("auth"):"";authSecret=i?btoa(String.fromCharCode.apply(null,new Uint8Array(i))):"";$.ajax({url:"/api/getsubscription",type:"GET",data:{auth:authSecret,name:n.cleanName},success:function(t){t&&(t.currencyName==n.cleanName?$("#checkcurrency").prop("checked",!0):t.currencyName=="top50"&&$("#checkcurrencytop50").prop("checked",!0),$("#btnunsubscribe").removeClass("d-none"),$("#btnsubscribe").addClass("d-none"),$("input:radio").attr("disabled",!0))}})}}))}})});$(".subscribe").on("click",function(){var t=$(".modal-body input:checked").val();const i=urlB64ToUint8Array(applicationServerPublicKey);swRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:i}).then(function(i){n("subscribe",i,t)}).catch(function(n){console.log("Failed to subscribe the user: ",n)})});$(".unsubscribe").on("click",function(){var t=$(".modal-body input:checked").val();const i=urlB64ToUint8Array(applicationServerPublicKey);swRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:i}).then(function(i){n("unsubscribe",i,t)}).catch(function(n){console.log("Failed to subscribe the user: ",n)})})});